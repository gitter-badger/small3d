CMAKE_MINIMUM_REQUIRED(VERSION 3.0.2)

PROJECT(small3d)

IF("${CMAKE_CXX_COMPILER_ID}" MATCHES "Clang")
  #SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -Weverything -Wno-c++98-compat -pedantic")
ENDIF()


IF(DEFINED BUILD_WITH_CONAN AND BUILD_WITH_CONAN)
  INCLUDE(${CMAKE_BINARY_DIR}/conanbuildinfo.cmake)
  CONAN_BASIC_SETUP()
  SUBDIRS(small3d)
ELSE()
  SUBDIRS(small3d)
  IF (APPLE OR WIN32)
    SET(DEPS_PATH "${CMAKE_SOURCE_DIR}/deps")
    SET(CMAKE_PREFIX_PATH ${DEPS_PATH})
    IF (APPLE)
      SET(GLEW_LIBRARY "${DEPS_PATH}/lib/libGLEW.a")
    ENDIF ()
  ENDIF ()

  SET(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)
  FIND_PACKAGE(OpenGL REQUIRED)
  FIND_PACKAGE(SDL2 REQUIRED)
  FIND_PACKAGE(GLEW REQUIRED)
  FIND_PACKAGE(PNG REQUIRED)
  FIND_PACKAGE(GLM)
  FIND_PACKAGE(OGG REQUIRED)
  FIND_PACKAGE(VORBIS REQUIRED)
  FIND_PACKAGE(PORTAUDIO REQUIRED)
  FIND_PACKAGE(FREETYPE REQUIRED)
  IF(NOT WIN32)
    FIND_PACKAGE(Bzip2 REQUIRED)
  ENDIF()
  
  IF(WIN32)
    FILE(GLOB dlls "deps/lib/*.dll")
    FOREACH(dll ${dlls})
      FILE(COPY ${dll} DESTINATION "./small3d/src/Debug")
      FILE(COPY ${dll} DESTINATION "./small3d/src/Release")
    ENDFOREACH()
  ENDIF()
ENDIF()

IF (WIN32)
  FILE(COPY "small3d/resources" DESTINATION "./small3d/src/Debug")
  FILE(COPY "small3d/resources" DESTINATION "./small3d/src/Release")
ELSE (WIN32)
  FILE(COPY "small3d/resources" DESTINATION "./small3d/src")
ENDIF (WIN32)
