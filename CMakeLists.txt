CMAKE_MINIMUM_REQUIRED(VERSION 3.0.2)
PROJECT(small3d)
IF(DEFINED BUILD_WITH_CONAN AND BUILD_WITH_CONAN)
  INCLUDE(conan/conanbuildinfo.cmake)
  CONAN_BASIC_SETUP()
  SUBDIRS(small3d)
  SET(DEPS_PATH )
  SET(CMAKE_PREFIX_PATH "${CMAKE_SOURCE_DIR}/conan/")
ELSE()
  SUBDIRS(small3d samplegame)
  IF (APPLE OR WIN32)
    SET(DEPS_PATH "${CMAKE_SOURCE_DIR}/deps")
    SET(CMAKE_PREFIX_PATH ${DEPS_PATH})
    IF (APPLE)
      SET(GLEW_LIBRARY "${DEPS_PATH}/lib/libGLEW.a")
    ENDIF ()
  ENDIF ()
ENDIF()

SET(CMAKE_MODULE_PATH ${PROJECT_SOURCE_DIR}/cmake)


FIND_PACKAGE(OpenGL REQUIRED)
FIND_PACKAGE(SDL2 REQUIRED)
FIND_PACKAGE(SDL2_ttf REQUIRED)
FIND_PACKAGE(GLEW REQUIRED)
FIND_PACKAGE(PNG REQUIRED)
FIND_PACKAGE(GLM)

IF(NOT DEFINED BUILD_WITH_CONAN OR NOT BUILD_WITH_CONAN)
    FIND_PACKAGE(OGG REQUIRED)
	FIND_PACKAGE(VORBIS REQUIRED)
	FIND_PACKAGE(PORTAUDIO REQUIRED)
ENDIF()

IF (WIN32)
  FILE(COPY "small3d/resources" DESTINATION "./small3d/src/Debug")
  FILE(COPY "small3d/resources" DESTINATION "./samplegame/src/Debug")
  FILE(COPY "small3d/resources" DESTINATION "./small3d/src/Release")
  FILE(COPY "small3d/resources" DESTINATION "./samplegame/src/Release")
  IF(NOT DEFINED BUILD_WITH_CONAN OR NOT BUILD_WITH_CONAN)
    FILE(COPY "samplegame/resources" DESTINATION "./small3d/src/Debug")
    FILE(COPY "samplegame/resources" DESTINATION "./samplegame/src/Debug")
    FILE(COPY "samplegame/resources" DESTINATION "./small3d/src/Release")
    FILE(COPY "samplegame/resources" DESTINATION "./samplegame/src/Release")
    FILE(GLOB dlls "deps/lib/*.dll")
    FOREACH(dll ${dlls})
      FILE(COPY ${dll} DESTINATION "./small3d/src/Debug")
      FILE(COPY ${dll} DESTINATION "./samplegame/src/Debug")
      FILE(COPY ${dll} DESTINATION "./small3d/src/Release")
      FILE(COPY ${dll} DESTINATION "./samplegame/src/Release")
    ENDFOREACH()
  ENDIF()
ELSE (WIN32)
  FILE(COPY "small3d/resources" DESTINATION "./small3d/src")
  FILE(COPY "small3d/resources" DESTINATION "./samplegame/src")
  IF(NOT DEFINED BUILD_WITH_CONAN OR NOT BUILD_WITH_CONAN)
    FILE(COPY "samplegame/resources" DESTINATION "./small3d/src")
    FILE(COPY "samplegame/resources" DESTINATION "./samplegame/src")
  ENDIF()
ENDIF (WIN32)
